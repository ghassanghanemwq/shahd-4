<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shahd 4 — Ultra UI</title>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
  }
}
</script>

<style>
  :root{
    --bg:#ffffff; --text:#0b0b10; --muted:#6c6c78; --edge:#e7e7ec;
    --primary:#8B0E2A; --primary-2:#A01832;
    --available:#f3f3f0; 
    --reserved:#002D62;  /* dark blue for reserved */
    --sold:#df1a25; 
    --selected:#22c55e;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font:14px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  #scene{position:fixed;inset:0;background:var(--bg)}
  canvas{display:block;width:100%;height:100%}

  #brand{position:fixed;left:12px;top:12px;z-index:12;display:flex;align-items:center;gap:10px}
  #brand img{height:34px;display:block}
  @media (max-width:600px){ #brand img{height:26px} }

  #menu{position:fixed;right:12px;top:12px;display:inline-flex;align-items:center;justify-content:center;
    width:42px;height:42px;border-radius:12px;border:1px solid #ececf3;background:#fff;cursor:pointer;
    box-shadow:0 6px 16px rgba(0,0,0,.05);z-index:13}
  #menu.hidden{display:none}

  #topbar{position:fixed;inset:12px 72px auto 72px;display:flex;justify-content:center;z-index:12}
  #search{width:min(560px,100%);padding:12px 14px;border-radius:12px;border:1px solid #e6e6ee;background:#fff;color:#111;outline:none;
    box-shadow:0 0 0 0 rgba(139,14,42,0),0 12px 24px rgba(0,0,0,.05);transition:box-shadow .2s ease,border-color .2s ease}
  #search::placeholder{color:#9aa}
  #search:focus{border-color:#d7d7e2;box-shadow:0 0 0 3px rgba(160,24,50,.08),0 12px 30px rgba(0,0,0,.06)}
  #results{position:absolute;top:54px;width:min(560px,calc(100% - 24px));background:#fff;border:1px solid #e8e8f0;border-radius:12px;overflow:auto;max-height:42vh;box-shadow:0 22px 40px rgba(0,0,0,.08);display:none}
  .result{display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;color:#111}
  .result:hover{background:#fafafa}
  .badge{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #eee;color:#333;background:#f8f8ff;margin-left:auto}

  #label{position:fixed;pointer-events:none;transform:translate(-50%,-120%);padding:6px 10px;background:rgba(0,0,0,.78);
    border:1px solid rgba(0,0,0,.1);border-radius:8px;color:#fff;font-weight:700;font-size:12px;box-shadow:0 8px 30px rgba(0,0,0,.15);
    display:none;z-index:8}
  .lotLabel{position:absolute;padding:2px 6px;border:1px solid rgba(0,0,0,.1);border-radius:6px;background:rgba(255,255,255,.86);
    color:#111;font-weight:700;font-size:11px;letter-spacing:.02em;pointer-events:none;user-select:none;white-space:nowrap;
    backdrop-filter:blur(2px);transition:opacity .18s linear}

  #bottomBar{position:fixed;left:10px;right:10px;bottom:10px;display:grid;grid-template-columns:1fr auto 1fr;align-items:end;z-index:9}
  #legend{display:flex;gap:8px;justify-self:start}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid var(--edge);color:#222}
  .chip::before{content:'';width:8px;height:8px;border-radius:50%}
  .chip.avail::before{background:var(--available)}
  .chip.resv::before{background:var(--reserved)}  /* dark blue legend */
  .chip.sold::before{background:var(--sold)}
</style>
</head>
<body>
  <!-- brand -->
  <a id="brand" href="#"><img src="svg-01.svg" alt="Brand logo" /></a>
  <button id="menu">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M4 7h16M4 12h16M4 17h16" stroke="#8B0E2A" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>

  <div id="topbar">
    <input id="search" placeholder="Search lot (e.g. 012 or Lot_012)" />
    <div id="results"></div>
  </div>

  <div id="scene">
    <div id="loading">LOADING… 0%</div>
    <canvas id="c"></canvas>
    <div id="label"></div>
  </div>

  <div id="bottomBar">
    <div id="legend">
      <span class="chip avail">Available</span>
      <span class="chip resv">Reserved</span>
      <span class="chip sold">Sold</span>
    </div>
  </div>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';
import { MeshoptDecoder } from 'three/addons/libs/meshopt_decoder.module.js';
import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

const CONFIG = { glbUrl:'./map.glb', highlight:0x8B0E2A };
let RAW={},LOTS={},INDEX=[];
fetch('lots.json').then(r=>r.json()).then(d=>{RAW=d||{};normalize();});

const canvas=document.getElementById('c');
const loading=document.getElementById('loading');

const renderer=new THREE.WebGLRenderer({canvas,antialias:true});
renderer.setPixelRatio(Math.min(devicePixelRatio,2));
renderer.setSize(innerWidth,innerHeight);
renderer.outputColorSpace=THREE.SRGBColorSpace;
renderer.toneMapping=THREE.ACESFilmicToneMapping;

const scene=new THREE.Scene();
scene.environment=(new THREE.PMREMGenerator(renderer)).fromScene(new RoomEnvironment(renderer),0.03).texture;
const camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,0.1,4000);
const controls=new OrbitControls(camera,renderer.domElement);

const key=new THREE.DirectionalLight(0xffffff,1.15);key.position.set(2,5,2);scene.add(key);
scene.add(new THREE.AmbientLight(0xffffff,0.45));
const ground=new THREE.Mesh(new THREE.PlaneGeometry(4000,4000),new THREE.MeshStandardMaterial({color:0xffffff}));
ground.rotation.x=-Math.PI/2;scene.add(ground);

let GLB;const LOT_MESHES=new Map();

function normalize(){LOTS={};INDEX=[];for(const [k,v]of Object.entries(RAW)){if(/^Lot_\d{3,4}$/.test(k)){LOTS[k]={status:v.Status?.toLowerCase()||null};INDEX.push({id:k});}}}

function recolorByStatus(){
  const offWhite=getComputedStyle(document.documentElement).getPropertyValue('--available').trim()||'#f3f3f0';
  const darkBlue=getComputedStyle(document.documentElement).getPropertyValue('--reserved').trim()||'#002D62';
  LOT_MESHES.forEach((meshes,id)=>{
    const s=(LOTS[id]?.status||'').toLowerCase();
    let base=offWhite;
    if(s.startsWith('sold')) base='#df1a25';
    else if(s.startsWith('res')) base=darkBlue;
    meshes.forEach(o=>{
      const mat=(o.material&&o.material.clone())||new THREE.MeshStandardMaterial();
      mat.color.set(base);
      o.material=mat;
    });
  });
}
</script>
</body>
</html>
